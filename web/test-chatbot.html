<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Chatbot AI</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .test-section h2 {
            color: #1976d2;
            margin-top: 0;
            font-size: 1.2em;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            min-height: 100px;
            font-family: monospace;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        button:hover {
            background: #1565c0;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #1976d2;
            border-radius: 4px;
        }
        .result pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .success {
            border-left-color: #4caf50;
            background: #e8f5e9;
        }
        .loading {
            display: inline-block;
            margin-left: 10px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.connected {
            background: #4caf50;
            color: white;
        }
        .status.disconnected {
            background: #f44336;
            color: white;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Test Chatbot AI - dbdiagram-oss</h1>
        
        <div class="info">
            <strong>Estado del API:</strong> <span id="apiStatus" class="status disconnected">Verificando...</span>
        </div>

        <!-- Test 1: Verificar API Key -->
        <div class="test-section">
            <h2>1Ô∏è‚É£ Configurar API Key</h2>
            <div class="input-group">
                <label>Proveedor AI:</label>
                <select id="provider">
                    <option value="gemini">Google Gemini (Free)</option>
                    <option value="openai">OpenAI GPT-4o-mini</option>
                </select>
            </div>
            <div class="input-group">
                <label>API Key:</label>
                <input type="password" id="apiKey" placeholder="Ingresa tu API key aqu√≠">
                <small style="color: #666; display: block; margin-top: 5px;">
                    Se guardar√° en localStorage para pruebas
                </small>
            </div>
            <button onclick="saveApiKey()">üíæ Guardar API Key</button>
            <button onclick="checkApiKey()">üîç Verificar Key Guardada</button>
            <div id="keyResult" style="margin-top: 10px;"></div>
        </div>

        <!-- Test 2: Generar DBML desde Cero -->
        <div class="test-section">
            <h2>2Ô∏è‚É£ Generar DBML desde Cero</h2>
            <div class="input-group">
                <label>Prompt:</label>
                <textarea id="prompt" placeholder="Ej: Create tables for users, roles, and permissions">Create tables for users, roles, and permissions</textarea>
            </div>
            <button onclick="generateDbml()" id="generateBtn">üöÄ Generar DBML</button>
            <div id="generateResult"></div>
        </div>

        <!-- Test 3: Probar Contexto (NUEVO) -->
        <div class="test-section" style="background: #e8f5e9; border-color: #4caf50;">
            <h2>3Ô∏è‚É£ Probar Contexto y Modificaciones <span style="background: #4caf50; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em;">NUEVO</span></h2>
            
            <div class="input-group">
                <label>Esquema DBML Actual (Contexto):</label>
                <textarea id="currentSchema" placeholder="Pega aqu√≠ un esquema DBML existente o usa el de ejemplo">Table users {
  id integer [pk, increment]
  username varchar(50) [unique, not null]
  email varchar(100) [unique, not null]
  created_at timestamp [default: `now()`]
}

Table posts {
  id integer [pk, increment]
  title varchar(200) [not null]
  content text
  created_at timestamp [default: `now()`]
}</textarea>
            </div>
            
            <div class="input-group">
                <label>Prompt de Modificaci√≥n:</label>
                <select id="modificationPrompt" onchange="updateModificationPrompt()">
                    <option value="">-- Selecciona un ejemplo o escribe el tuyo --</option>
                    <option value="A√±ade relaci√≥n entre users y posts">A√±ade relaci√≥n entre users y posts</option>
                    <option value="Add a comments table with relations">Add a comments table with relations</option>
                    <option value="Edita posts para a√±adir campo published">Edita posts para a√±adir campo published</option>
                    <option value="Agrega una tabla categories y relaci√≥nala con posts">Agrega una tabla categories y relaci√≥nala con posts</option>
                    <option value="Modify users to include profile fields">Modify users to include profile fields</option>
                    <option value="custom">‚úèÔ∏è Escribir personalizado</option>
                </select>
                <textarea id="customModificationPrompt" style="margin-top: 10px; display: none;" placeholder="Escribe tu prompt de modificaci√≥n aqu√≠..."></textarea>
            </div>
            
            <button onclick="generateWithContext()" id="contextBtn">üîÑ Generar con Contexto</button>
            <button onclick="clearContext()" style="background: #ff9800;">üóëÔ∏è Limpiar Contexto</button>
            
            <div id="contextResult"></div>
        </div>

        <!-- Test 4: Comparar Antes vs Despu√©s -->
        <div class="test-section">
            <h2>4Ô∏è‚É£ Comparar: Sin Contexto vs Con Contexto</h2>
            <p style="color: #666; font-size: 0.9em;">
                Esta prueba genera DBML dos veces con el mismo prompt: una sin contexto y otra con contexto para ver la diferencia.
            </p>
            
            <div class="input-group">
                <label>Prompt de Prueba:</label>
                <input type="text" id="comparePrompt" value="Add a likes table" placeholder="Ej: Add a likes table">
            </div>
            
            <button onclick="compareContexts()" id="compareBtn">‚öñÔ∏è Comparar Resultados</button>
            <div id="compareResult"></div>
        </div>

        <!-- Test 5: Verificar Conexi√≥n -->
        <div class="test-section">
            <h2>5Ô∏è‚É£ Informaci√≥n del Sistema</h2>
            <button onclick="checkSystem()">üîç Verificar Sistema</button>
            <div id="systemResult"></div>
        </div>
    </div>

    <script>
        // Funci√≥n para guardar API key
        function saveApiKey() {
            const provider = document.getElementById('provider').value;
            const apiKey = document.getElementById('apiKey').value.trim();
            
            if (!apiKey) {
                showResult('keyResult', '‚ö†Ô∏è Por favor ingresa un API key', 'error');
                return;
            }
            
            localStorage.setItem(`ai_${provider}_key`, apiKey);
            showResult('keyResult', `‚úÖ API key guardada para ${provider}`, 'success');
            checkApiStatus();
        }

        // Funci√≥n para verificar API key guardada
        function checkApiKey() {
            const provider = document.getElementById('provider').value;
            const savedKey = localStorage.getItem(`ai_${provider}_key`);
            
            if (savedKey) {
                const maskedKey = savedKey.substring(0, 8) + '...' + savedKey.substring(savedKey.length - 4);
                showResult('keyResult', `üîë API key encontrada: ${maskedKey}`, 'success');
            } else {
                showResult('keyResult', `‚ùå No hay API key guardada para ${provider}`, 'error');
            }
        }

        // Funci√≥n para generar DBML
        async function generateDbml() {
            const prompt = document.getElementById('prompt').value.trim();
            const provider = document.getElementById('provider').value;
            const apiKey = localStorage.getItem(`ai_${provider}_key`);
            
            if (!apiKey) {
                showResult('generateResult', '‚ùå Primero debes guardar tu API key', 'error');
                return;
            }
            
            if (!prompt) {
                showResult('generateResult', '‚ö†Ô∏è Por favor ingresa un prompt', 'error');
                return;
            }
            
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Generando...';
            
            try {
                let result;
                if (provider === 'gemini') {
                    result = await generateWithGemini(prompt, apiKey);
                } else if (provider === 'openai') {
                    result = await generateWithOpenAI(prompt, apiKey);
                }
                
                const html = `
                    <div class="result success">
                        <strong>‚úÖ DBML Generado Exitosamente</strong>
                        <p><strong>Proveedor:</strong> ${provider}</p>
                        <p><strong>Tiempo:</strong> ${result.duration}ms</p>
                        <pre>${result.dbmlCode}</pre>
                    </div>
                `;
                document.getElementById('generateResult').innerHTML = html;
                
            } catch (error) {
                showResult('generateResult', `‚ùå Error: ${error.message}`, 'error');
            }
            
            btn.disabled = false;
            btn.innerHTML = 'üöÄ Generar DBML';
        }

        // Generar con Gemini
        async function generateWithGemini(prompt, apiKey, currentSchema = '') {
            const startTime = Date.now();
            
            // Detectar si es una modificaci√≥n
            const modificationKeywords = ['edita', 'edit', 'modifica', 'modify', 'a√±ade', 'add', 'agrega', 'cambia', 'change', 'actualiza', 'update', 'relacion', 'relationship', 'entre', 'between'];
            const isModification = modificationKeywords.some(keyword => prompt.toLowerCase().includes(keyword));
            const hasContext = currentSchema && currentSchema.trim().length > 0;
            
            let systemPrompt = `Eres un arquitecto de bases de datos experto. Genera SOLO c√≥digo DBML v√°lido, sin explicaciones.
            
REGLAS OBLIGATORIAS:
1. Usa nombres en ingl√©s (snake_case)
2. Incluye primary keys con [pk, increment]
3. A√±ade timestamps con [default: \`now()\`]
4. ‚ö†Ô∏è CR√çTICO: Las referencias (Ref:) deben ir FUERA de las tablas, NUNCA dentro
5. ‚ö†Ô∏è PROHIBIDO: NO uses [ref: > tabla.campo] dentro de columnas
6. Usa formato correcto: Ref: tabla1.campo > tabla2.campo (fuera de la tabla)
7. Para primary keys compuestas, usa: indexes { (campo1, campo2) [pk] }

FORMATO CORRECTO:
Table posts {
  id integer [pk, increment]
  user_id integer [not null]
}

Table user_roles {
  user_id integer [not null]
  role_id integer [not null]
  indexes {
    (user_id, role_id) [pk]
  }
}

// ‚úÖ Referencias FUERA
Ref: posts.user_id > users.id
Ref: user_roles.user_id > users.id

FORMATO INCORRECTO (NO HACER):
Table posts {
  user_id integer [ref: > users.id]  // ‚ùå PROHIBIDO
}
Table user_roles {
  [pk: (user_id, role_id)]  // ‚ùå INCORRECTO
}`;

            let fullPrompt = systemPrompt;
            
            // Si hay contexto y es modificaci√≥n
            if (hasContext && isModification) {
                fullPrompt += `\n\n‚ö†Ô∏è IMPORTANTE: Debes devolver el esquema COMPLETO, incluyendo todas las tablas existentes m√°s las modificaciones solicitadas.\n\nESQUEMA ACTUAL:\n\`\`\`dbml\n${currentSchema}\n\`\`\`\n\nINSTRUCCIONES PARA MODIFICACI√ìN:\n- Devuelve el esquema COMPLETO (no solo los cambios)\n- Mant√©n TODAS las tablas existentes sin cambios\n- Aplica SOLO las modificaciones solicitadas`;
            } else if (hasContext) {
                fullPrompt += `\n\nESQUEMA ACTUAL:\n\`\`\`dbml\n${currentSchema}\n\`\`\`\n\nINSTRUCCIONES:\n- Solo genera las NUEVAS tablas solicitadas\n- No repitas las existentes\n- Usa nombres que ya existen para referencias`;
            }
            
            fullPrompt += `\n\nUser Request: ${prompt}`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: fullPrompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.3,
                        maxOutputTokens: 2000,
                    }
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`Gemini API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
            }
            
            const result = await response.json();
            const dbmlCode = result.candidates?.[0]?.content?.parts?.[0]?.text || '';
            
            return {
                dbmlCode: cleanDbmlCode(dbmlCode),
                duration: Date.now() - startTime,
                provider: 'gemini',
                hasContext: hasContext,
                isModification: hasContext && isModification
            };
        }

        // Generar con OpenAI
        async function generateWithOpenAI(prompt, apiKey, currentSchema = '') {
            const startTime = Date.now();
            
            // Detectar si es una modificaci√≥n
            const modificationKeywords = ['edita', 'edit', 'modifica', 'modify', 'a√±ade', 'add', 'agrega', 'cambia', 'change', 'actualiza', 'update', 'relacion', 'relationship', 'entre', 'between'];
            const isModification = modificationKeywords.some(keyword => prompt.toLowerCase().includes(keyword));
            const hasContext = currentSchema && currentSchema.trim().length > 0;
            
            const systemPrompt = `Eres un arquitecto de bases de datos experto. Genera SOLO c√≥digo DBML v√°lido, sin explicaciones.`;
            
            const messages = [
                { role: 'system', content: systemPrompt }
            ];
            
            // Si hay contexto y es modificaci√≥n
            if (hasContext && isModification) {
                messages.push({
                    role: 'user',
                    content: `‚ö†Ô∏è IMPORTANTE: Debes devolver el esquema COMPLETO.\n\nESQUEMA ACTUAL:\n\`\`\`dbml\n${currentSchema}\n\`\`\``
                });
                messages.push({
                    role: 'user',
                    content: `${prompt}\n\nDevuelve el esquema COMPLETO con las modificaciones.`
                });
            } else if (hasContext) {
                messages.push({
                    role: 'user',
                    content: `ESQUEMA ACTUAL:\n\`\`\`dbml\n${currentSchema}\n\`\`\`\n\n${prompt}\n\nSolo genera las NUEVAS tablas.`
                });
            } else {
                messages.push({
                    role: 'user',
                    content: prompt
                });
            }

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: messages,
                    max_tokens: 2000,
                    temperature: 0.3
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`OpenAI API Error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
            }
            
            const result = await response.json();
            const dbmlCode = result.choices[0].message.content.trim();
            
            return {
                dbmlCode: cleanDbmlCode(dbmlCode),
                duration: Date.now() - startTime,
                provider: 'openai',
                hasContext: hasContext,
                isModification: hasContext && isModification
            };
        }

        // Limpiar c√≥digo DBML
        function cleanDbmlCode(text) {
            return text.replace(/```dbml\n?/g, '').replace(/```\n?/g, '').trim();
        }

        // Verificar sistema
        function checkSystem() {
            const info = {
                localStorage: typeof localStorage !== 'undefined',
                geminiKey: !!localStorage.getItem('ai_gemini_key'),
                openaiKey: !!localStorage.getItem('ai_openai_key'),
                navigator: navigator.userAgent,
                online: navigator.onLine
            };
            
            const html = `
                <div class="result">
                    <strong>‚ÑπÔ∏è Informaci√≥n del Sistema</strong>
                    <pre>${JSON.stringify(info, null, 2)}</pre>
                </div>
            `;
            document.getElementById('systemResult').innerHTML = html;
        }

        // Verificar estado del API
        function checkApiStatus() {
            const geminiKey = localStorage.getItem('ai_gemini_key');
            const openaiKey = localStorage.getItem('ai_openai_key');
            const statusEl = document.getElementById('apiStatus');
            
            if (geminiKey || openaiKey) {
                statusEl.className = 'status connected';
                statusEl.textContent = 'Configurado';
            } else {
                statusEl.className = 'status disconnected';
                statusEl.textContent = 'Sin configurar';
            }
        }

        // Funci√≥n helper para mostrar resultados
        function showResult(elementId, message, type = '') {
            const html = `<div class="result ${type}">${message}</div>`;
            document.getElementById(elementId).innerHTML = html;
        }

        // Verificar estado al cargar
        window.addEventListener('load', () => {
            checkApiStatus();
            checkApiKey();
        });

        // ========== NUEVAS FUNCIONES PARA CONTEXTO ==========

        // Actualizar prompt de modificaci√≥n
        function updateModificationPrompt() {
            const select = document.getElementById('modificationPrompt');
            const customTextarea = document.getElementById('customModificationPrompt');
            
            if (select.value === 'custom') {
                customTextarea.style.display = 'block';
            } else {
                customTextarea.style.display = 'none';
            }
        }

        // Generar con contexto
        async function generateWithContext() {
            const currentSchema = document.getElementById('currentSchema').value.trim();
            const selectValue = document.getElementById('modificationPrompt').value;
            const customPrompt = document.getElementById('customModificationPrompt').value.trim();
            const prompt = selectValue === 'custom' ? customPrompt : selectValue;
            const provider = document.getElementById('provider').value;
            const apiKey = localStorage.getItem(`ai_${provider}_key`);
            
            if (!apiKey) {
                showResult('contextResult', '‚ùå Primero debes guardar tu API key', 'error');
                return;
            }
            
            if (!currentSchema) {
                showResult('contextResult', '‚ö†Ô∏è Por favor ingresa un esquema DBML actual como contexto', 'error');
                return;
            }
            
            if (!prompt) {
                showResult('contextResult', '‚ö†Ô∏è Por favor selecciona o escribe un prompt de modificaci√≥n', 'error');
                return;
            }
            
            const btn = document.getElementById('contextBtn');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Generando con contexto...';
            
            try {
                let result;
                if (provider === 'gemini') {
                    result = await generateWithGemini(prompt, apiKey, currentSchema);
                } else if (provider === 'openai') {
                    result = await generateWithOpenAI(prompt, apiKey, currentSchema);
                }
                
                const contextBadge = result.isModification 
                    ? '<span style="background: #2196F3; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px;">üîÑ Modified Schema</span>'
                    : result.hasContext
                    ? '<span style="background: #FF9800; color: white; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px;">‚ûï New Tables</span>'
                    : '';
                
                const html = `
                    <div class="result success">
                        <strong>‚úÖ DBML Generado con Contexto</strong> ${contextBadge}
                        <p><strong>Proveedor:</strong> ${provider}</p>
                        <p><strong>Tiempo:</strong> ${result.duration}ms</p>
                        <p><strong>Tiene Contexto:</strong> ${result.hasContext ? '‚úÖ S√≠' : '‚ùå No'}</p>
                        <p><strong>Es Modificaci√≥n:</strong> ${result.isModification ? '‚úÖ S√≠ (Schema completo)' : '‚ùå No (Solo nuevas tablas)'}</p>
                        <p style="background: #fff3cd; padding: 10px; border-radius: 4px; color: #856404; margin-top: 10px;">
                            <strong>üí° Nota:</strong> ${result.isModification 
                                ? 'El esquema devuelto incluye TODAS las tablas (existentes + modificaciones). Esto reemplazar√≠a el contenido completo del editor.'
                                : 'El esquema devuelto incluye SOLO las nuevas tablas generadas. Esto se a√±adir√≠a al final del editor.'}
                        </p>
                        <pre>${result.dbmlCode}</pre>
                    </div>
                `;
                document.getElementById('contextResult').innerHTML = html;
                
            } catch (error) {
                showResult('contextResult', `‚ùå Error: ${error.message}`, 'error');
            }
            
            btn.disabled = false;
            btn.innerHTML = 'üîÑ Generar con Contexto';
        }

        // Limpiar contexto
        function clearContext() {
            document.getElementById('currentSchema').value = '';
            document.getElementById('modificationPrompt').value = '';
            document.getElementById('customModificationPrompt').value = '';
            document.getElementById('customModificationPrompt').style.display = 'none';
            document.getElementById('contextResult').innerHTML = '';
        }

        // Comparar contextos
        async function compareContexts() {
            const prompt = document.getElementById('comparePrompt').value.trim();
            const provider = document.getElementById('provider').value;
            const apiKey = localStorage.getItem(`ai_${provider}_key`);
            
            if (!apiKey) {
                showResult('compareResult', '‚ùå Primero debes guardar tu API key', 'error');
                return;
            }
            
            if (!prompt) {
                showResult('compareResult', '‚ö†Ô∏è Por favor ingresa un prompt', 'error');
                return;
            }
            
            const btn = document.getElementById('compareBtn');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Comparando...';
            
            const sampleSchema = `Table users {
  id integer [pk, increment]
  username varchar(50)
  email varchar(100)
}

Table posts {
  id integer [pk, increment]
  title varchar(200)
  content text
}`;
            
            try {
                // Generar sin contexto
                let resultWithoutContext;
                if (provider === 'gemini') {
                    resultWithoutContext = await generateWithGemini(prompt, apiKey, '');
                } else {
                    resultWithoutContext = await generateWithOpenAI(prompt, apiKey, '');
                }
                
                // Esperar 1 segundo para no saturar la API
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Generar con contexto
                let resultWithContext;
                if (provider === 'gemini') {
                    resultWithContext = await generateWithGemini(prompt, apiKey, sampleSchema);
                } else {
                    resultWithContext = await generateWithOpenAI(prompt, apiKey, sampleSchema);
                }
                
                const html = `
                    <div class="result success">
                        <strong>‚öñÔ∏è Comparaci√≥n de Resultados</strong>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                            <div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 15px;">
                                <h3 style="margin-top: 0; color: #666;">‚ùå Sin Contexto</h3>
                                <p style="font-size: 0.9em; color: #666;">La IA no sabe qu√© tablas ya existen</p>
                                <p><strong>Tiempo:</strong> ${resultWithoutContext.duration}ms</p>
                                <pre style="max-height: 400px; overflow-y: auto;">${resultWithoutContext.dbmlCode}</pre>
                            </div>
                            
                            <div style="border: 2px solid #4caf50; border-radius: 8px; padding: 15px; background: #f1f8f4;">
                                <h3 style="margin-top: 0; color: #4caf50;">‚úÖ Con Contexto</h3>
                                <p style="font-size: 0.9em; color: #666;">La IA conoce users y posts</p>
                                <p><strong>Tiempo:</strong> ${resultWithContext.duration}ms</p>
                                <pre style="max-height: 400px; overflow-y: auto;">${resultWithContext.dbmlCode}</pre>
                            </div>
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 4px; margin-top: 20px;">
                            <strong>üìä An√°lisis:</strong>
                            <ul style="margin: 10px 0;">
                                <li><strong>Sin contexto:</strong> Genera tabla independiente sin considerar las existentes</li>
                                <li><strong>Con contexto:</strong> ${resultWithContext.isModification ? 'Genera esquema completo modificado' : 'Genera solo la nueva tabla con referencias correctas'}</li>
                            </ul>
                        </div>
                    </div>
                `;
                document.getElementById('compareResult').innerHTML = html;
                
            } catch (error) {
                showResult('compareResult', `‚ùå Error: ${error.message}`, 'error');
            }
            
            btn.disabled = false;
            btn.innerHTML = '‚öñÔ∏è Comparar Resultados';
        }
    </script>
</body>
</html>
